---
title: "Modify phylogenetic trees"
author: "Lisa"
date: "10/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
packages <- c("ape","magrittr")
for (package in packages){
  if (!require(package, character.only = TRUE)) install.packages(package)
  require(package, character.only = TRUE)
}
```

```{r}
if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
packages <- c("ggtree")
for (package in packages){
  if (!require(package, character.only = TRUE)) BiocManager::install(package)
  require(package, character.only = TRUE)
}
```

### Import phylogenetic trees
```{r}
nj_tree <- ape::read.tree("../results/panaroo_output_all/nj_snp_tree.newick")
ml_tree <- ape::read.tree("../results/panaroo_output_all/RAxML_bestTree.ml_tree")
```

Let's take a look
```{r}
ggtree(nj_tree)
ggtree(ml_tree)
```
We already see the trees produced by the different methods are quite different.

### Modify trees
There is one sample that has an extremely long edge length, it seems to be a species other than E. coli entirely.
We can exclude it.
```{r}
nj_tree_dropped <- ape::drop.tip(nj_tree,"ECO-JSC-RGN-103823")
ml_tree_dropped <- ape::drop.tip(ml_tree,"ECO-JSC-RGN-103823")
```

The trees are unrooted. We can use the divergent sample as the root before excluding it.
```{r}
nj_tree_rooted <- root(nj_tree,"ECO-JSC-RGN-103823") %>% ape::drop.tip("ECO-JSC-RGN-103823")
ml_tree_rooted <- root(ml_tree,"ECO-JSC-RGN-103823") %>% ape::drop.tip("ECO-JSC-RGN-103823")
```
Let's look at the rooted trees
```{r}
ggtree(nj_tree_rooted,layout = "circular")
ggtree(ml_tree_rooted, layout = "circular")
```

Save trees
```{r}
write.tree(nj_tree_rooted,"../results/final_nj_tree.newick")
write.tree(ml_tree_rooted,"../results/final_ml_tree.newick")
```
